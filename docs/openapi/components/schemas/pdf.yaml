PDFSource:
  type: object
  description: PDF源文件和一些相关信息
  required:
    - source 
  properties:
    source:
      type: string
      format: binary
      description: PDF源文件

Dimension:
  type: object
  description: PDF文件单页的尺寸
  required:
    - width
    - height
  properties:
    width:
      type: number
      format: float
    height:
      type: number
      format: float

Paragraph:
  type: object
  description: 解析后的PDF段落对象，代码见parse_paragraphs函数
  required:
    - id
    - page
    - index
    - bbox
    - content
    - wordCount
  properties:
    id:
      type: string
      description: 段落ID段落唯一标识符 (格式：pdf_chk_{pdf_id前8位}_{页码}_{块号})
      example: "pdf_chk_11451419_198_10"
    page:
      type: integer
      description: 页数
      minimum: 1
    index:
      type: integer
      description: 当前页面的文本块索引(PyMuPDF block_no)
      minimum: 1
    bbox:
      type: array
      description: 段落在PDF页面中的坐标，[x0, y0, x1, y1]（单位：PDF points）
      items:
        type: number
        format: float
      example: [100.0, 100.0, 200.0, 200.0]
    content:
      type: string
      description: '清洗后的文本内容，如果文本块完全位于顶部或底部区域，视为噪音；忽略len<5的非实质性文本碎片'
      example: "This is a test paragraph."
    wordCount:
      type: integer
      description: 段落中单词数量
      minimum: 1
      example: 10

ParagraphList:
  type: array
  description: 段落的列表
  items:
    $ref: '#/Paragraph'

Metadata:
  type: object
  description: PDF文件的元数据，依托史。这些字段由 fitz.Document.metadata（PyMuPDF）从 PDF 文件自身的元数据中提取。
  example:
    "title": "Attention Is All You Need"
    "author": "Ashish Vaswani et al."
    "subject": ""
    "keywords": ""
    "creator": "LaTeX"
    "producer": "pdfTeX-1.40.17"
    "creationDate": "D:20170612..."
    "modDate": "D:20170612..."
    "format": "PDF 1.5"
    

# 下面是请求/响应的schema

UploadResponse:
  type: object
  properties:
    pdfId:
      type: string
      description: 文件Hash，作为PDF的全局唯一标识
    taskId:
      type: string
      description: Celery异步任务ID，用于轮询处理进度
    status:
      type: string
      description: 任务状态，包括pending, processing, completed, failed
    pageCount:
      type: integer
      description: PDF文件的页数
    filename:
      type: string
      description: 上传时的原始文件名
    userId:
      type: string
      description: 当前用户UUID
    isNewUpload:
      type: boolean
      description: 用file_hash查globalfile表，true 表示文件不存在，需要重新上传；false 表示文件已存在（秒传）

StatusResponse:
  type: object
  required:
    - status
    - currentPage
    - totalPages
    - error
    - paragraphs
  properties:
    status:
      type: string
      description: 任务状态，包括pending, processing, completed, failed
    currentPage:
      type: integer
      description: 当前处理到的页数
    totalPages:
      type: integer
      description: PDF文件的总页数
    error:
      type: string
      description: 错误信息
      example: "Invalid file type"
    paragraphs:
      $ref: '#/ParagraphList'


InfoResponse:
  type: object
  # TODO: 修改接口
  required:
    - id
    - pageCount
    - metadata
  properties:
    id:
      type: string
      description: PDF文件Hash
    pageCount:
      type: integer
      description: PDF文件的页数
    metadata:
      description: PDF文件的元数据,这些字段由 fitz.Document.metadata（PyMuPDF）从 PDF 文件自身的元数据中提取。
      $ref: '#/Metadata'
    dimensions:
      type: array
      description: PDF文件每页的尺寸
      items:
        $ref: '#/Dimension'

SourceResponse:
  description: PDF源文件和一些相关信息
  $ref: '#/PDFSource'
    