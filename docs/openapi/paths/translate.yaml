# 所有接口需要 JWT 认证 (require_auth)

paragraph:
  post:
    tags: [Translate]
    summary: 翻译段落（按需触发，带缓存）
    description: 
      前端点击某段落的翻译按钮时调用。
      后端流程：解析段落 ID → 从 DB 取原文 → 调用 LLM 翻译 → 结果存库。
      已翻译过的段落会命中缓存直接返回，除非 force=true。
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/translate.yaml#/TranslateParagraphRequest'
    responses:
      200:
        description: 翻译结果
        content:
          application/json:
            schema:
              $ref: '../components/schemas/translate.yaml#/TranslateParagraphResponse'
      400:
        description: 缺少参数或段落 ID 格式错误
        content:
          application/json:
            schema:
              $ref: '../components/schemas/common.yaml#/ErrorResponse'
      404:
        description: 段落原文为空
        content:
          application/json:
            schema:
              $ref: '../components/schemas/common.yaml#/ErrorResponse'
      500:
        description: 服务器错误
        content:
          application/json:
            schema:
              $ref: '../components/schemas/common.yaml#/ErrorResponse'

text:
  post:
    tags: [Translate]
    summary: 翻译选中文本（带上下文）
    description: |
      用户框选一段文字后调用。
      如果提供了 pdfId，后端会取前 N 段原文作为上下文，帮助 LLM 更准确地翻译。
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/translate.yaml#/TranslateTextRequest'
    responses:
      200:
        description: 翻译结果
        content:
          application/json:
            schema:
              $ref: '../components/schemas/translate.yaml#/TranslateTextResponse'
      400:
        description: 缺少 text 或 text 为空
        content:
          application/json:
            schema:
              $ref: '../components/schemas/common.yaml#/ErrorResponse'
      500:
        description: 服务器错误
        content:
          application/json:
            schema:
              $ref: '../components/schemas/common.yaml#/ErrorResponse'

page-translations:
  get:
    tags: [Translate]
    summary: 获取某页的所有历史翻译
    description: 用户刷新页面后，前端批量获取之前翻译过的段落缓存
    parameters:
      - name: pdf_id
        in: path
        required: true
        description: PDF 文件 Hash
        schema:
          type: string
      - name: page_number
        in: path
        required: true
        description: 页码
        schema:
          type: integer
    responses:
      200:
        description: 该页所有已翻译的段落
        content:
          application/json:
            schema:
              $ref: '../components/schemas/translate.yaml#/PageTranslationsResponse'
      500:
        description: 服务器错误
        content:
          application/json:
            schema:
              $ref: '../components/schemas/common.yaml#/ErrorResponse'
